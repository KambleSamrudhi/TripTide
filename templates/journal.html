{% extends "base.html" %}
{% block content %}

<h1 class="text-2xl font-bold text-[#132473] mb-4">Travel Journal</h1>

<p class="text-gray-600 text-sm mb-6">
    Capture your memories, photos & notes from your journey.
</p>


<!-- ============================= -->
<!-- STATIC SAMPLE ENTRIES (YOURS) -->
<!-- ============================= -->

<div class="rounded-xl shadow-lg overflow-hidden mb-8">
    <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb"
         class="w-full h-52 object-cover">

    <div class="p-4">
        <h2 class="font-bold text-xl text-[#132473]">Day 1 — First Impressions</h2>
        <p class="text-gray-600 text-sm mt-2">
            The city welcomed me with golden skies, friendly people & calm vibes.
        </p>
        <p class="text-xs text-gray-500 mt-2">Saved on: 12 Nov 2025</p>
    </div>
</div>


<div class="rounded-xl shadow-lg overflow-hidden mb-8">
    <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e"
         class="w-full h-52 object-cover">

    <div class="p-4">
        <h2 class="font-bold text-xl text-[#132473]">Day 2 — Beachside Morning</h2>
        <p class="text-gray-600 text-sm mt-2">
            Early sunrise at the beach. Peaceful, warm breeze — unforgettable morning.
        </p>
        <p class="text-xs text-gray-500 mt-2">Saved on: 13 Nov 2025</p>
    </div>
</div>


<div class="rounded-xl shadow-lg overflow-hidden mb-8">
    <img src="https://images.unsplash.com/photo-1507494924047-60b8ee826ca9?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8bGlnaHRzfGVufDB8fDB8fHww"
         class="w-full h-52 object-cover">

    <div class="p-4">
        <h2 class="font-bold text-xl text-[#132473]">Day 3 — Festival Lights</h2>
        <p class="text-gray-600 text-sm mt-2">
            Spent the evening dancing, eating local treats & enjoying street music.
        </p>
        <p class="text-xs text-gray-500 mt-2">Saved on: 14 Nov 2025</p>
    </div>
</div>


<!-- ===================================== -->
<!-- DYNAMIC ENTRIES FROM JSON (NEW ONES) -->
<!-- ===================================== -->
{% for j in entries %}
<div class="rounded-xl shadow-lg overflow-hidden mb-8 bg-white">
    
    {% if j.image %}
    <img src="{{ j.image }}"
         class="w-full h-52 object-cover">
    {% endif %}

    <div class="p-4">
        <h2 class="font-bold text-xl text-[#132473]">
            Memory #{{ j.id }}
        </h2>

        <p class="text-gray-600 text-sm mt-2">
            {{ j.text }}
        </p>

        <p class="text-xs text-gray-500 mt-2">
            Saved on: {{ j.date }}
        </p>
    </div>
</div>
{% endfor %}


<!-- ADD NEW ENTRY BUTTON -->
<div class="text-center mt-10 mb-6">
    <button class="new-memory-btn" onclick="window.location.href='/journal/new'">
        + New Memory
    </button>
</div>
<!-- ===================== -->
<!-- JOURNAL ONLY FEEDBACK -->
<!-- ===================== -->


<script>
function submitFeedback() {
    let sus = Number(document.getElementById("sus_score").value);
    let nps = Number(document.getElementById("nps_score").value);

    fetch("/api/sus", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ answers: sus })
    });

    fetch("/api/nps", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ score: nps })
    });

    alert("Thank you! Your feedback has been recorded.");
}
</script>


<!-- BUTTON STYLING -->
<style>
.new-memory-btn {
    background: linear-gradient(135deg, #196561, #132473);
    color: white;
    padding: 14px 28px;
    font-size: 18px;
    font-weight: 600;
    border: none;
    border-radius: 14px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    transition: 0.25s ease;
}
.new-memory-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.25);
    background: linear-gradient(135deg, #14504d, #101f59);
}
</style>
<!-- JOURNAL PAGE SURVEY MODAL -->
<div id="journalSurvey" 
     class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  
  <div class="bg-white rounded-xl p-6 w-96 max-w-[90%] shadow-xl relative 
            max-h-[80vh] overflow-y-scroll custom-scroll">


    <!-- Close -->
    <button onclick="document.getElementById('journalSurvey').classList.add('hidden')"
        class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 text-xl font-bold">
        ×
    </button>

    <h2 class="text-xl font-bold mb-4 text-[#196561]">Rate Your Journal Experience</h2>

    <form id="journalSurveyForm" class="space-y-6">

        <!-- SUS questions -->
        <div class="space-y-3" id="susQuestions"></div>

        <!-- NPS -->
        <div>
            <label class="font-semibold text-[#196561]">Would you recommend TripTide?</label>
            <select id="npsScore" class="border p-2 rounded w-full">
                <option disabled selected>Select</option>
                {% for i in range(0,11) %}
                <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- CSAT -->
        <div>
            <label class="font-semibold text-[#196561]">How satisfied are you overall?</label>
            <select id="csatScore" class="border p-2 rounded w-full">
                <option disabled selected>Select</option>
                <option value="1">Very Dissatisfied</option>
                <option value="2">Dissatisfied</option>
                <option value="3">Neutral</option>
                <option value="4">Satisfied</option>
                <option value="5">Very Satisfied</option>
            </select>
        </div>

        <button type="submit"
                class="bg-[#196561] text-white px-4 py-2 rounded w-full">
            Submit Feedback
        </button>
    </form>

  </div>
</div>


<script>
/* SUS questions list */
const susList = [
    "I think I would like to use this app frequently.",
    "I find the app unnecessarily complex.",
    "I think the app is easy to use.",
    "I think I would need help from a technical person to use this app.",
    "I find the features well integrated.",
    "I think there is too much inconsistency in the app.",
    "I imagine most people would learn to use this app quickly.",
    "I find the app very cumbersome to use.",
    "I feel very confident using this app.",
    "I needed to learn a lot before I could start using the app."
];

const container = document.getElementById("susQuestions");

susList.forEach((q, i)=> {
    container.innerHTML += `
        <div>
            <label class="text-sm">${i+1}. ${q}</label>
            <select class="susAnswer border p-2 rounded w-full mt-1">
                <option disabled selected>Select</option>
                <option value="1">Strongly disagree</option>
                <option value="2">Disagree</option>
                <option value="3">Neutral</option>
                <option value="4">Agree</option>
                <option value="5">Strongly agree</option>
            </select>
        </div>
    `;
});

/* Show modal once per user */
if (!localStorage.getItem("journalSurveyDone")) {
    setTimeout(()=> {
        document.getElementById("journalSurvey").classList.remove("hidden");
    }, 800);
}

/* Submit handler */
document.getElementById("journalSurveyForm").onsubmit = async function(e){
    e.preventDefault();

    let sus = [...document.querySelectorAll(".susAnswer")].map(a=> Number(a.value));
    let nps = Number(document.getElementById("npsScore").value);
    let csat = Number(document.getElementById("csatScore").value);

    let res = await fetch("/api/survey/submit", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ sus, nps, csat })
    });

    if (res.ok){
        localStorage.setItem("journalSurveyDone", "1");
        document.getElementById("journalSurvey").classList.add("hidden");
        alert("Thank you for your feedback!");
    }
};
</script>
<style>
/* Make scrollbars invisible but scroll functional */
.custom-scroll {
    scrollbar-width: none;        /* Firefox */
    -ms-overflow-style: none;     /* IE/Edge */
}

.custom-scroll::-webkit-scrollbar {
    width: 0;
    height: 0;
}
</style>

{% endblock %}
